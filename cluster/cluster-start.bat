@ECHO OFF

ECHO ======================================================================
ECHO 1. Stop and remove containers
ECHO ======================================================================
docker-compose -f docker-compose.yml -f docker-compose-app.yml down
ECHO ======================================================================
ECHO.

ECHO ======================================================================
ECHO 2. Building the application
ECHO ======================================================================
cd ..
call mvn clean
call mvn package
ECHO ======================================================================
ECHO.

ECHO ======================================================================
ECHO 3. Creating a Docker image
ECHO ======================================================================
cd cluster
copy /y ..\kafka-course-unit-1\target\kc-*.jar *.jar
docker build . -t kc-unit-1:1.0.0
ECHO ======================================================================
ECHO.

ECHO ======================================================================
ECHO 4. Starting kafka cluster
ECHO ======================================================================
docker-compose up -d
ECHO ======================================================================
ECHO.

ECHO ======================================================================
ECHO 5. Waiting for cluster to start...
ECHO ======================================================================
timeout /t 30 /NOBREAK
ECHO ======================================================================
ECHO.

ECHO ======================================================================
ECHO 6. Creating the "passages" topic
ECHO ======================================================================
call topic/add-passage-topic.bat
ECHO ======================================================================
ECHO.

ECHO ======================================================================
ECHO 7. Get metadata of the "passages" topic
ECHO ======================================================================
call topic/passages-topic-info.bat
ECHO ======================================================================
ECHO.

ECHO ======================================================================
ECHO 8. Launching the application
ECHO ======================================================================
docker-compose -f docker-compose.yml -f docker-compose-app.yml up -d
ECHO ======================================================================
pause